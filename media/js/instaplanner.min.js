"use strict";function escapeHtml(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}function objectToArray(e){let t=[],a=[],n=Object.keys(e);n.sort(function(e,t){return e-t});for(let r=0;r<n.length;r++)t.push(e[n[r]]),a.push(n[r]);return[a,t]}function jsonParse(e){return""!=e&&!!/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}function isMobile(){return jQuery("html").height()<992}function themeFunctions(){jQuery(".instaplaner__navigation--clone").css("height",jQuery(".instaplaner__navigation").outerHeight()+"px"),jQuery(".instaplaner__footer--clone").css("height",jQuery(".instaplaner__footer").outerHeight()+"px"),jQuery("#show_hide_password a").on("click",function(e){e.preventDefault(),"text"==jQuery("#show_hide_password input").attr("type")?jQuery("#show_hide_password input").attr("type","password"):"password"==jQuery("#show_hide_password input").attr("type")&&jQuery("#show_hide_password input").attr("type","text")})}function page__dashboard(){function e(e=0,t=null,a=null,n=!1,r=!0){let o=document.createElement("div");o.style.display="none",o.dataset.id=e,o.classList.add("col-4"),o.classList.add("col-lg-4"),o.classList.add("reveal-item"),o.classList.add("instaplaner__post"),r?o.classList.add("instaplaner__post--preview"):o.classList.add("instaplaner__post--dragger");let s=document.createElement("div");s.classList.add("instaplaner__posts--post");let l=document.createElement("div");l.classList.add("instaplaner__posts--drag");let i=document.createElement("div");i.classList.add("instaplaner__posts--drag__icon"),l.appendChild(i);let u=document.createElement("div");u.classList.add("instaplaner__posts__square"),null!=t&&(u.style.backgroundImage='url("'+t+'")');let p=document.createElement("div"),d=document.createElement("p");p.classList.add("instaplaner__posts--description"),p.dataset.id=e,p.dataset.image=t,p.dataset.description=a,null!=a&&(d.appendChild(document.createTextNode(a)),p.appendChild(d)),s.appendChild(u),s.appendChild(p),s.appendChild(l),o.appendChild(s),n?jQuery("#instaplaner__posts").prepend(o):jQuery("#instaplaner__posts").append(o),jQuery(o).show("slow")}function t(){jQuery("#login-alert").is(":visible")&&jQuery("#login-alert").slideToggle();let t=new FormData;t.append("nonce",jQuery("#addphoto_nonce").val()),t.append("action",jQuery("#addphoto_action").val()),t.append("input-account",jQuery("#addphoto_account").val()),t.append("input-description",jQuery("#input-description").val()),t.append("input-file",jQuery("#input-file")[0].files[0]),jQuery.ajax({url:page_data.ajax,type:"post",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){if(console.log(t),jsonParse(t)){let a=JSON.parse(t);e(a[0],page_data.baseurl+page_data.posts_path+a[1],jQuery("#input-description").val(),!0,!jQuery("#instaplaner_nav_reorder").hasClass("active")),jQuery("#input-file").val(""),jQuery("#instaplaner__addphoto").modal("hide"),jQuery("#input-description").val("")}},fail:function(e,t,a){}})}new Sortable(document.getElementById("instaplaner__posts"),{handle:".instaplaner__posts--drag",draggable:".instaplaner__post--dragger",easing:"cubic-bezier(1, 0, 0, 1)",animation:300,setData:function(e,t){let a=document.createElement("div");a.style.opacity=0,e.setDragImage(a,0,0)},onEnd:function(e){let t=[],a=jQuery("#instaplaner__posts").children();for(let e=0;e<a.length;e++)t.push(jQuery(a[e]).data().id);for(let e=t.length-1;e>-1&&0==t[e];e--)t.splice(e,1);jQuery.ajax({url:page_data.ajax,type:"post",data:{action:"save_reorder",nonce:page_data.order_nonce,account:page_data.current_account_id,order:JSON.stringify(t)},success:function(e){console.log("The order of the list has been saved")},fail:function(e,t,a){}})}}),jQuery(".instaplaner__loader").delay(1e3).fadeOut("slow",function(){for(var t=0;t<page_data.posts.length;t++)e(page_data.posts[t][0],page_data.posts[t][1],page_data.posts[t][2]);if(console.log(page_data.posts.length%3),page_data.posts.length>0){let a=6-page_data.posts.length%3;6==a&&(a=3);for(t=0;t<a;t++)e()}}),jQuery("#btn-add-blank").on("click",function(t){t.preventDefault(),e(0,null,"Blank post",!0,!jQuery("#instaplaner_nav_reorder").hasClass("active")),jQuery("#instaplaner__addphoto").modal("hide")}),jQuery("#instaplaner_nav_list").on("click",function(e){e.preventDefault(),jQuery(this).addClass("active"),jQuery("#instaplaner_nav_reorder").removeClass("active"),jQuery(".instaplaner__toast__mode .toast-body").html("You have entered edit mode"),jQuery(".instaplaner__toast__mode").toast("show"),jQuery(".instaplaner__post").removeClass("instaplaner__post--dragger"),jQuery(".instaplaner__post").addClass("instaplaner__post--preview")}),jQuery("#instaplaner_nav_reorder").on("click",function(e){e.preventDefault(),jQuery(".instaplaner__toast__mode .toast-body").html("You have entered reorder mode"),jQuery(".instaplaner__toast__mode").toast("show"),jQuery(this).addClass("active"),jQuery("#instaplaner_nav_list").removeClass("active"),jQuery(".instaplaner__post").removeClass("instaplaner__post--preview"),jQuery(".instaplaner__post").addClass("instaplaner__post--dragger")}),new ClipboardJS(".instaplaner__editphoto--copy",{text:function(e){return jQuery("#input-current-description").val()}}),jQuery(document.body).on("click",".instaplaner__posts--description",function(e){let t=jQuery(this).data();if(console.log(t),0!=t.id){jQuery("#instaplaner__editphoto").modal("show");let e="."+/(?:\.([^.]+))?$/.exec(t.image)[1];jQuery(".instaplaner__editphoto--download").attr("download","instaplanner-"+t.id+e),jQuery(".instaplaner__editphoto--download").attr("href",t.image),jQuery(".instaplaner__editphoto--delete__confirm, .instaplaner__editphoto--update").attr("data-id",t.id),jQuery("#instaplaner__editphoto img").attr("src",t.image),jQuery("#input-current-description").val(t.description),jQuery(".instaplaner__editphoto--copy").attr("data-clipboard-text",t.description)}}),jQuery("#instaplanner_addphoto--upload").on("click",function(e){e.preventDefault(),t()}),jQuery("#instaplanner_addphoto--form").on("submit",function(e){e.preventDefault(),t()}),jQuery(".instaplaner__editphoto--update").on("click",function(e){e.preventDefault();let t=jQuery(this).data("id");jQuery.ajax({url:page_data.ajax,type:"post",data:{action:"update_post",nonce:page_data.update_nonce,post:t,description:jQuery("#input-current-description").val()},success:function(e){console.log(e),"s01"==e&&(jQuery("#instaplaner__editphoto").modal("hide"),jQuery(".instaplaner__posts--description").filter(function(){return jQuery(this).data("id")==t}).html("<p>"+jQuery("#input-current-description").val()+"</p>").attr("data-description",jQuery("#input-current-description").val()))},fail:function(e,t,a){}})}),jQuery(".instaplaner__editphoto--delete").on("click",function(e){e.preventDefault(),jQuery(".instaplaner__editphoto--alert").slideToggle("fast",function(){jQuery(".instaplaner__editphoto--alert").is(":hidden")&&jQuery(".instaplaner__editphoto--alert").slideToggle()}),console.log("delete")}),jQuery(".instaplaner__editphoto--delete__confirm").on("click",function(e){e.preventDefault();let t=jQuery(this).data("id");jQuery.ajax({url:page_data.ajax,type:"post",data:{action:"delete_post",nonce:page_data.delete_nonce,post:t},success:function(e){console.log(e),"s01"==e&&(jQuery("#instaplaner__editphoto").modal("hide"),jQuery(".instaplaner__post").filter(function(){return jQuery(this).data("id")==t}).remove())},fail:function(e,t,a){}}),console.log("totaly delete")})}function page__install(){jQuery("#install-instaplanner").on("click",function(e){e.preventDefault(),jQuery("#install-instaplanner").attr("disabled","disabled"),jQuery("#install-form > div, #install-instaplanner, #install-form-alert").fadeOut(200),jQuery("#install-form").slideUp(400,function(){jQuery("#install-progress").slideDown(400)}),jQuery.ajax({url:page_data.baseurl,type:"post",data:{action:"setup",input_scriptname:jQuery("#input_scriptname").val(),input_baseuri:jQuery("#input_baseuri").val(),input_db_name:jQuery("#input_db_name").val(),input_db_user:jQuery("#input_db_user").val(),input_db_host:jQuery("#input_db_host").val(),input_db_password:jQuery("#input_db_password").val(),input_user_name:jQuery("#input_user_name").val(),input_user_password:jQuery("#input_user_password").val()},success:function(e){if(console.log(e),jsonParse(e)&&null!=e){let t=JSON.parse(e);"error"==t.status?window.setTimeout(function(){jQuery("#install-form, #install-form-alert").hide(),jQuery("#install-form > div, #install-instaplanner, #install-progress").show(),jQuery("#install-form-alert > span").html(t.message),jQuery("#install-progress").slideUp(400,function(){jQuery("#install-instaplanner").removeAttr("disabled"),jQuery("#install-form").slideDown(400,function(e){jQuery("#install-form-alert").slideDown(400)})})},1500):"success"==t.status&&window.setTimeout(function(){jQuery("#install-progress").fadeOut(400,function(){jQuery("#install-done").fadeIn(400),window.setTimeout(function(){window.location.href=jQuery("#input_baseuri").val()+"dashboard"},3e3)})},1e3)}else console.log("error")},fail:function(e,t,a){jQuery("#install-progress").slideUp(400),console.log(e),console.log(t),alert(a)}})})}function page__login(){function e(){jQuery("#login-alert").is(":visible")&&jQuery("#login-alert").slideToggle(),jQuery.ajax({url:page_data.ajax,type:"post",data:jQuery("#login-form").serialize(),success:function(e){console.log(e),"s01"==e?location.reload():jQuery("#login-alert").slideToggle()},fail:function(e,t,a){jQuery("#login-alert").slideToggle()}})}jQuery("#button-form").on("click",function(t){t.preventDefault(),e()}),jQuery("#login-form").on("submit",function(t){t.preventDefault(),e()})}function page__settings(){let e={};function t(){let t="https://www.instagram.com/"+jQuery("#input-account-name").val()+"/?__a=1";jQuery("#instaplaner__addaccount--fetch").attr("disabled","disabled"),$.getJSON(t,function(t){t.hasOwnProperty("graphql")&&t.graphql.hasOwnProperty("user")&&(e.name=jQuery("#input-account-name").val(),e.full_name=t.graphql.user.full_name,e.biography=t.graphql.user.biography,e.url=t.graphql.user.external_url,e.avatar=t.graphql.user.profile_pic_url_hd,e.followers=t.graphql.user.edge_followed_by.count,e.following=t.graphql.user.edge_follow.count,e.posts=t.graphql.user.edge_owner_to_timeline_media.count,jQuery(".instaplaner__addaccount--preview h3").html(jQuery("#input-account-name").val()),jQuery(".instaplaner__addaccount--preview h4").html(t.graphql.user.full_name),jQuery(".instaplaner__addaccount--preview p").html(t.graphql.user.biography),jQuery(".instaplaner__addaccount--preview a").html(t.graphql.user.external_url),jQuery(".instaplaner__addaccount--preview img").attr("src",t.graphql.user.profile_pic_url_hd),jQuery("#instaplaner__addaccount--followers").html(t.graphql.user.edge_followed_by.count),jQuery("#instaplaner__addaccount--following").html(t.graphql.user.edge_follow.count),jQuery("#instaplaner__addaccount--posts").html(t.graphql.user.edge_owner_to_timeline_media.count),jQuery(".instaplaner__addaccount--preview").slideToggle(),jQuery("#instaplaner__addaccount--save").removeAttr("disabled"),console.log(t))}),console.log(jQuery("#input-account-name").val())}add_new_account&&jQuery("#instaplaner__addaccount").modal("show"),jQuery("#instaplaner__addaccount--form").on("submit",function(e){e.preventDefault(),jQuery("#instaplaner__addaccount--fetch").is(":not(:disabled)")&&t()}),jQuery("#instaplaner__addaccount--fetch").on("click",function(e){e.preventDefault(),t()}),jQuery("#instaplaner__addaccount--save").on("click",function(t){t.preventDefault(),e.hasOwnProperty("name")&&(e.nonce=register_account_nonce,e.action="register_account",console.log(e),jQuery.ajax({url:page_data.ajax,type:"post",data:e,success:function(e){console.log(e)},fail:function(e,t,a){}})),console.log(e)}),jQuery("#save-settings").on("click",function(e){e.preventDefault(),console.log("save settings")})}console.log(page_data),document.addEventListener("DOMContentLoaded",function(){jQuery(function(e){e(document).ready(function(){themeFunctions(),"dashboard"==page_data.pagenow?page__dashboard():"install"==page_data.pagenow?page__install():"login"==page_data.pagenow?page__login():"settings"==page_data.pagenow&&page__settings()})})});